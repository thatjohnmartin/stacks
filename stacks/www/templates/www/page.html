{% extends "www/base.html" %}

{% block title %}{{ page.title }}{% endblock %}

{% block css %}
    <link href="/static/lib/bootstrap-editable/css/bootstrap-editable.css" rel="stylesheet">
    <link href="/static/lib/jquery.fineuploader/fineuploader.css" rel="stylesheet">
{% endblock %}

{% block body_class %}page{% endblock %}

{% block content %}
    <h1 id="title">{{ page.title}}</h1>
    {{ content }}
{#    <div class="row" style="margin-top:20px;">#}
{#        <div class="span9">#}
{#            {% include "www/inc/comments.html" %}#}
{#        </div>#}
{#    </div>#}
{% endblock %}

{% block extra_scripts_after_bootstrap %}
    <script src="/static/lib/bootstrap-editable/js/bootstrap-editable.js"></script>
    <script src="/static/lib/jquery.fineuploader/jquery.fineuploader-3.0.js"></script>
{% endblock %}

{% block page_scripts %}
    <script type="text/javascript">

        var pendingInactiveDrops = false;

        $(document).ready(function () {
            $('#title').editable({
                inputclass: 'input-xlarge2',
                placement: 'bottom',
                pk: {{ page.id }},
                url: '{{ url_for("page.edit") }}',
                type: 'text',
                title: 'Enter title',
                params: {'csrfmiddlewaretoken': '{{ csrf_token }}'}
            });

            $('#rhcol').editable({inputclass:'rhcol', send:'never'});

            $('#image-1').fineUploader({
                request: {
                    endpoint: '/upload/'
                },
                text: {
                    uploadButton: '<i class="icon-upload"></i> Upload'
                },
                dragAndDrop: {
                    extraDropzones: [$('#image-1')],
                    hideDropzones: false,
                    disableDefaultDropzone: true
                },
                debug: true
            }).on('complete', function(event, id, filename, responseJSON){
                console.log('Got the thing!');
            });

            $(document.body).on('dragenter', function(e) {
                $('#image-1').addClass('active');
                console.log('enter');
            });

            $('#image-1').on('dragenter', function(e) {
                $('#image-1').addClass('active');
            });

            $(document.body).on('dragleave dragexit', function(e) {
                if (e.originalEvent.pageX <= $(window).scrollLeft()
                    || e.originalEvent.pageY <= $(window).scrollTop()
                    || e.originalEvent.pageX >= $(window).scrollLeft() + $(window).width()
                    || e.originalEvent.pageY >= $(window).scrollTop() + $(window).height()) {
                    $('#image-1').removeClass('active');
                }
            });

        });
    </script>
{% endblock %}
